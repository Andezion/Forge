<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Formulas - Forge</title>
    <meta name="description" content="Detailed explanation of all analytics formulas used in Forge for tracking workout progress, strength gains, and performance metrics.">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <nav>
        <div class="container">
            <a href="index.html" class="logo">FORGE</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="formulas.html">Formulas</a></li>
                <li><a href="technical.html">Technical Docs</a></li>
                <li><a href="contributing.html">Contributing</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <section>
            <h1>Analytics Formulas</h1>
            <p>Forge uses scientifically-backed formulas to calculate your progress metrics. This page explains each formula in detail.</p>
        </section>

        <section id="strength-coefficient">
            <h2>Overall Strength Coefficient</h2>
            <p>The Strength Coefficient is a comprehensive metric that tracks your overall strength development across <strong>all exercises</strong>.</p>

            <div class="formula">
                <div class="formula-title">Base Formula</div>
                <div class="formula-content">
                    Strength Coefficient = (Î£(max_weight / first_weight) / exercise_count) Ã— 100
                </div>
                <div class="formula-explanation">
                    <strong>Where:</strong>
                    <ul>
                        <li><strong>max_weight:</strong> The maximum weight lifted for each exercise across the lookback period</li>
                        <li><strong>first_weight:</strong> The first recorded weight for that exercise</li>
                        <li><strong>exercise_count:</strong> Total number of unique exercises performed</li>
                    </ul>
                </div>
            </div>

            <h3>How It Works</h3>
            <p>The algorithm:</p>
            <ol>
                <li>Filters workout history to the specified lookback period (default 90 days)</li>
                <li>For each exercise, tracks:
                    <ul>
                        <li>The first weight you ever used (baseline)</li>
                        <li>The maximum weight you've lifted</li>
                        <li>The date you achieved that max</li>
                    </ul>
                </li>
                <li>Calculates the progress ratio for each exercise: <code>current_max / first_weight</code></li>
                <li>Averages all ratios and multiplies by 100</li>
            </ol>

            <h3>Interpretation</h3>
            <ul>
                <li><strong>100:</strong> Baseline (no progress from starting weights)</li>
                <li><strong>150:</strong> You're 50% stronger overall than when you started</li>
                <li><strong>200:</strong> You've doubled your strength across all exercises</li>
            </ul>

            <div class="formula">
                <div class="formula-title">Progress Percentage</div>
                <div class="formula-content">
                    Progress % = ((current_coefficient - previous_coefficient) / previous_coefficient) Ã— 100
                </div>
                <div class="formula-explanation">
                    Shows your improvement rate compared to the second-to-last data point.
                </div>
            </div>
        </section>

        <section id="exercise-progress">
            <h2>Exercise-Specific Progress</h2>
            <p>Track detailed progress for individual exercises with three key metrics.</p>

            <div class="formula">
                <div class="formula-title">1. Maximum Weight Tracking</div>
                <div class="formula-content">
                    max_weight = max(set_1.weight, set_2.weight, ..., set_n.weight)
                </div>
                <div class="formula-explanation">
                    For each workout session, we record the heaviest weight lifted across all sets.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">2. Volume Calculation</div>
                <div class="formula-content">
                    Volume = Î£(weight Ã— actual_reps) for all sets
                </div>
                <div class="formula-explanation">
                    Total volume quantifies the total work performed. Higher volume typically indicates greater training stimulus.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">3. Intensity Metric</div>
                <div class="formula-content">
                    Intensity (%) = (average_weight / max_weight) Ã— 100
                </div>
                <div class="formula-explanation">
                    <strong>Where:</strong>
                    <ul>
                        <li><strong>average_weight:</strong> Average weight across all sets in that session</li>
                        <li><strong>max_weight:</strong> The heaviest weight lifted in that session</li>
                    </ul>
                    <p>Intensity shows how close your working sets are to your maximum effort. Higher intensity (closer to 100%) indicates training closer to your max capacity.</p>
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">Progress Percentage</div>
                <div class="formula-content">
                    Progress % = ((current_max - previous_max) / previous_max) Ã— 100
                </div>
                <div class="formula-explanation">
                    Compares your latest max to your previous recorded max for this exercise.
                </div>
            </div>
        </section>

        <section id="body-weight">
            <h2>Body Weight Tracking</h2>
            <p>Monitor your body composition changes over time.</p>

            <div class="formula">
                <div class="formula-title">Weight Change</div>
                <div class="formula-content">
                    Weight Change = current_weight - start_weight
                </div>
                <div class="formula-explanation">
                    Tracks absolute change from your first recorded weight in the lookback period.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">Average Weight</div>
                <div class="formula-content">
                    Average Weight = Î£(weight_points) / total_points
                </div>
                <div class="formula-explanation">
                    Calculates your mean body weight across all recorded measurements.
                </div>
            </div>

            <h3>Data Integration</h3>
            <p>Body weight data is sourced from:</p>
            <ol>
                <li><strong>Profile Service:</strong> Direct weight entries from "Body Weight" screen</li>
                <li><strong>Weight History:</strong> Historical weight logs stored with timestamps</li>
                <li><strong>Workout Sessions:</strong> Fallback to current weight if no history exists</li>
            </ol>
        </section>

        <section id="volume">
            <h2>Workout Volume Analysis</h2>
            <p>Volume is the total amount of weight lifted, a key indicator of training stimulus.</p>

            <div class="formula">
                <div class="formula-title">Daily Volume</div>
                <div class="formula-content">
                    Daily Volume = Î£(weight Ã— reps) for all exercises in session
                </div>
                <div class="formula-explanation">
                    Aggregates the total volume for each workout day.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">Weekly Volume</div>
                <div class="formula-content">
                    Weekly Volume = Î£(daily_volumes) for all days in week
                </div>
                <div class="formula-explanation">
                    Sums up all daily volumes for each training week. Week starts on Monday.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">Average Volume</div>
                <div class="formula-content">
                    Average Volume = Î£(weekly_volumes) / total_weeks
                </div>
                <div class="formula-explanation">
                    Your typical weekly training volume across the entire lookback period.
                </div>
            </div>

            <h3>Week Definition</h3>
            <p>Weeks are calculated as Monday to Sunday periods using this helper function:</p>
            <pre><code>week_start = date - Duration(days: date.weekday - 1)</code></pre>
        </section>

        <section id="frequency">
            <h2>Workout Frequency</h2>
            <p>Track how often you train and maintain consistency streaks.</p>

            <div class="formula">
                <div class="formula-title">Weekly Frequency</div>
                <div class="formula-content">
                    Weekly Frequency = workouts_per_week
                </div>
                <div class="formula-explanation">
                    Counts the number of workout sessions completed each week.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">Average Frequency</div>
                <div class="formula-content">
                    Average Frequency = Î£(weekly_frequencies) / total_weeks
                </div>
                <div class="formula-explanation">
                    Your typical weekly training frequency.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">Streak Calculation</div>
                <div class="formula-content">
                    Streak += 1 if (previous_date - current_date) â‰¤ 2 days
                </div>
                <div class="formula-explanation">
                    Counts consecutive training days with a 2-day grace period to account for rest days.
                </div>
            </div>

            <h3>Streak Logic</h3>
            <p>The streak algorithm:</p>
            <ol>
                <li>Sorts all workout dates in descending order (most recent first)</li>
                <li>Starts from the most recent workout</li>
                <li>Continues the streak if workouts are within 2 days of each other</li>
                <li>Breaks the streak if the gap exceeds 2 days</li>
            </ol>
        </section>

        <section id="consistency">
            <h2>Consistency & Completion Rate</h2>
            <p>Measures how well you stick to your planned workouts.</p>

            <div class="formula">
                <div class="formula-title">Session Completion Rate</div>
                <div class="formula-content">
                    Session Completion % = (sets_completed / sets_planned) Ã— 100
                </div>
                <div class="formula-explanation">
                    Calculates what percentage of planned sets you actually completed in each session.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">Overall Completion Rate</div>
                <div class="formula-content">
                    Overall Completion % = (total_sets_completed / total_sets_planned) Ã— 100
                </div>
                <div class="formula-explanation">
                    Your aggregated completion rate across all workouts in the lookback period.
                </div>
            </div>

            <h3>What Counts</h3>
            <ul>
                <li><strong>Sets Planned:</strong> The target number of sets specified in your workout program</li>
                <li><strong>Sets Completed:</strong> The actual number of sets you logged</li>
            </ul>

            <h3>Interpretation</h3>
            <ul>
                <li><strong>&gt;90%:</strong> Excellent adherence to your program</li>
                <li><strong>75-90%:</strong> Good consistency with occasional incomplete workouts</li>
                <li><strong>&lt;75%:</strong> May need to adjust program difficulty or time management</li>
            </ul>
        </section>

        <section id="muscle-recovery">
            <h2>Muscle Recovery & Training Readiness</h2>
            <p>Forge tracks when each muscle group was last trained and calculates recovery priorities to recommend the best muscles to train next.</p>

            <div class="formula">
                <div class="formula-title">Days Since Last Training</div>
                <div class="formula-content">
                    days_since[group] = (now - last_training_date[group]).inDays
                </div>
                <div class="formula-explanation">
                    For each muscle group, the system scans all workout history (including old exercises matched to current muscle group assignments) and finds the most recent date that muscle was trained.
                    <br>Default value: <strong>14 days</strong> if a muscle group has never been trained.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">Recovery Priority</div>
                <div class="formula-content">
                    if days &lt; optimal: priority = (days / optimal) &times; 0.3<br>
                    if days == optimal: priority = 0.7<br>
                    if days &lt; optimal &times; 2: priority = 0.7 + ((days - optimal) / optimal) &times; 0.3<br>
                    if days &ge; optimal &times; 2: priority = 1.0 + ((days - optimal &times; 2) / 7).clamp(0, 0.5)
                </div>
                <div class="formula-explanation">
                    <strong>Where:</strong>
                    <ul>
                        <li><strong>days:</strong> Days since last training for this muscle group</li>
                        <li><strong>optimal:</strong> Optimal recovery days for this muscle group (see table below)</li>
                    </ul>
                    <p>Priority &lt; 0.3 = needs rest, 0.3&ndash;0.7 = recovering, &ge; 0.7 = ready to train.</p>
                </div>
            </div>

            <h3>Optimal Recovery Days per Muscle Group</h3>
            <table>
                <thead>
                    <tr>
                        <th>Muscle Group</th>
                        <th>Recovery Days</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Legs</td><td>3 days</td></tr>
                    <tr><td>Back</td><td>3 days</td></tr>
                    <tr><td>Glutes</td><td>3 days</td></tr>
                    <tr><td>Chest</td><td>2 days</td></tr>
                    <tr><td>Shoulders</td><td>2 days</td></tr>
                    <tr><td>Biceps</td><td>2 days</td></tr>
                    <tr><td>Triceps</td><td>2 days</td></tr>
                    <tr><td>Calves</td><td>2 days</td></tr>
                    <tr><td>Forearms</td><td>1 day</td></tr>
                    <tr><td>Wrists</td><td>1 day</td></tr>
                    <tr><td>Core</td><td>1 day</td></tr>
                    <tr><td>Cardio</td><td>1 day</td></tr>
                </tbody>
            </table>

            <div class="formula">
                <div class="formula-title">Workout Priority Score</div>
                <div class="formula-content">
                    Workout Priority = &Sigma;(recovery_priority[group] &times; muscle_score) / &Sigma;(muscle_score)
                </div>
                <div class="formula-explanation">
                    <strong>Where muscle_score depends on intensity:</strong>
                    <ul>
                        <li><strong>Primary:</strong> score = 3</li>
                        <li><strong>Secondary:</strong> score = 2</li>
                        <li><strong>Stabilizer:</strong> score = 1</li>
                    </ul>
                    <p>This weighted average prioritizes workouts that target muscles most in need of training, while accounting for which muscles are primary vs secondary in each exercise.</p>
                </div>
            </div>

            <h3>Cross-referencing Old History</h3>
            <p>When exercises in old workout history don't have muscle group assignments (because they were added before the muscle group feature), the system automatically matches them by exercise ID to the current exercise definitions. This ensures that <strong>all historical data</strong> is used when calculating days since last training, not just recent workouts.</p>
        </section>

        <section id="exercise-completion">
            <h2>Exercise Completion & Regression Tracking</h2>
            <p>Forge visually indicates exercise completion status and performance regression to help you stay on track.</p>

            <div class="formula">
                <div class="formula-title">Completion Status (Program View)</div>
                <div class="formula-content">
                    is_completed = exercise.id &isin; {last_session.exerciseResults[].exercise.id}
                </div>
                <div class="formula-explanation">
                    When viewing a program's exercise list, each exercise is checked against the most recent completed session of that workout. Exercises that were <strong>not completed</strong> last time are highlighted in <strong style="color: #d32f2f;">red</strong> with a &times; icon, so you know what you skipped and need to focus on next time.
                </div>
            </div>

            <div class="formula">
                <div class="formula-title">Rep Regression Detection (Calendar View)</div>
                <div class="formula-content">
                    is_regression = (current_total_reps &lt; previous_total_reps)<br>
                    where total_reps = &Sigma;(set.actualReps) for all sets of an exercise
                </div>
                <div class="formula-explanation">
                    When viewing workout history through the calendar, each exercise's total reps are compared against the previous session of the same workout. If you performed <strong>fewer total reps</strong> than last time, the exercise is highlighted in <strong style="color: #e65100;">yellow/orange</strong> with a trending-down indicator showing the comparison (e.g., "18 / 24 reps").
                </div>
            </div>
        </section>

        <section id="lookback">
            <h2>Lookback Period</h2>
            <p>All formulas use a configurable lookback period to filter relevant data.</p>

            <div class="formula">
                <div class="formula-title">Date Filtering</div>
                <div class="formula-content">
                    cutoff_date = current_date - Duration(days: lookback_days)
                </div>
                <div class="formula-explanation">
                    Only workouts after this cutoff date are included in calculations.
                </div>
            </div>

            <h3>Available Periods</h3>
            <ul>
                <li><strong>30 days:</strong> Recent short-term progress</li>
                <li><strong>90 days (default):</strong> Medium-term training cycles</li>
                <li><strong>180 days:</strong> Long-term trends and patterns</li>
                <li><strong>365 days:</strong> Annual progress and year-over-year comparison</li>
            </ul>
        </section>

        <section id="example">
            <h2>Example Calculation</h2>
            <p>Let's walk through a real example of calculating the Strength Coefficient.</p>

            <h3>Scenario</h3>
            <p>A user has tracked 3 exercises over 90 days:</p>
            <table>
                <thead>
                    <tr>
                        <th>Exercise</th>
                        <th>First Weight</th>
                        <th>Max Weight</th>
                        <th>Progress Ratio</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Bench Press</td>
                        <td>60 kg</td>
                        <td>90 kg</td>
                        <td>1.50</td>
                    </tr>
                    <tr>
                        <td>Squat</td>
                        <td>80 kg</td>
                        <td>120 kg</td>
                        <td>1.50</td>
                    </tr>
                    <tr>
                        <td>Deadlift</td>
                        <td>100 kg</td>
                        <td>140 kg</td>
                        <td>1.40</td>
                    </tr>
                </tbody>
            </table>

            <h3>Calculation</h3>
            <pre><code>Total Progress Ratio = 1.50 + 1.50 + 1.40 = 4.40
Exercise Count = 3
Strength Coefficient = (4.40 / 3) Ã— 100 = 146.67</code></pre>

            <h3>Result</h3>
            <p>This user has improved their overall strength by <strong>46.67%</strong> across all exercises!</p>
        </section>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 Forge. Built with ðŸ”¥ using Flutter & Firebase.</p>
            <p>
                <a href="https://github.com/vdoro/Dyplom">GitHub</a> |
                <a href="index.html">Home</a> |
                <a href="technical.html">Docs</a> |
                <a href="contributing.html">Contribute</a>
            </p>
        </div>
    </footer>
</body>
</html>
